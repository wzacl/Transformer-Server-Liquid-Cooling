# Transformer-Server-Liquid-Cooling

## 📌 專案簡介
本專案 `Transformer-Server-Liquid-Cooling` 利用 **Transformer 序列模型** 結合 **模型預測控制 (MPC)** 來實現伺服器液冷系統的智能溫度控制。透過 Encoder-Decoder 架構實現多步溫度預測，並以此為基礎構建先進控制策略，達到最佳化冷卻效率、降低能耗，同時提高伺服器運行穩定性。

核心創新點：
- 採用 **Transformer 自注意力機制** 捕捉時間序列溫度變化模式
- 基於模型預測實現 **前饋-反饋混合控制** 策略
- 應用 **優化算法** 動態調整控制參數

## 🔧 系統架構
### 硬體配置
- **電源供應器參數設置**：
  * 1KW：220V_8A
  * 1.5KW：285V_8A
  * 1.85KW：325V_8A

- **控制元件限制**：
  * 泵最低轉速：40% duty cycle
  * 風扇最低轉速：30% duty cycle

- **感測器配置**：
  * GPU 溫度感測器
  * CDU 入口/出口溫度感測器
  * 環境溫度感測器
  * 冷卻空氣入口/出口溫度感測器

### 軟體架構
- **資料收集模組** (`data_collection/`)
  * 實驗循環控制：系統性測試不同參數組合
  * 隨機參數測試：探索控制參數空間
  * 數據記錄與存儲：支援高頻數據採樣與存儲

- **控制單元** (`Control_Unit/`)
  * ADAMS 控制器：實現與溫度感測器的通訊和數據採集
  * PWM 控制器：精確控制泵速和風扇轉速
  * 多通道控制器：同時控制多個冷卻裝置

- **預測模型** (`Predict_Model/`)
  * Transformer 模型：基於注意力機制的序列到序列預測
  * 多步預測：實現 8 步前向溫度預測
  * 模型優化：動態權重調整和梯度裁剪

- **模型訓練** (`Model_Training/`)
  * 數據預處理：時間窗口切片和特徵縮放
  * 模型訓練：包含超參數優化和早停策略
  * 效能評估：使用 MAE 和 R² 等指標

- **控制器** (`Controllers/`)
  * MPC 控制器：基於模型預測的前饋控制
  * 優化算法：SA
  * 混合控制策略：結合 PID 與 MPC 的組合控制

## 💻 安裝指南
1. **環境需求**
```bash
Python 3.8+
PyTorch 1.8+
CUDA 11.0+ (可選，用於GPU加速)
```

2. **依賴套件**
```bash
pip install -r requirements.txt
```

3. **硬體連接**
```
ADAM 模組：/dev/ttyUSB0
泵控制：/dev/ttyAMA3
風扇1：/dev/ttyAMA4
風扇2：/dev/ttyAMA5
```

## 🚀 使用方法
### 1. 數據收集
```bash
# 執行循環實驗
python data_collection/experiment_cycle.py

# 執行隨機參數實驗
python data_collection/experiment_random.py
```

### 2. 模型訓練
```bash
# 訓練 Transformer 模型
python Model_Training/2KWCDU_Predictor_multi_v3.py
```

### 3. 系統控制
```bash


# 啟動模擬退火優化泵控
python Controllers/MPC/SA_pump_PID.py
```

## 📊 效能指標
- **預測準確度**：溫度預測平均誤差 < 1°C
- **控制穩定性**：溫度波動 < ±0.5°C
- **能源效率**：較傳統方案節能 15-20%
- **控制響應性**：系統擾動後穩態誤差 < 0.8°C

## 🧮 控制理論與模型設計
### Transformer 模型架構
- **位置編碼**：捕捉時間序列中位置信息
- **多頭自注意力**：並行處理不同特徵間的關係
- **編碼器-解碼器結構**：實現多步溫度預測
- **掩碼機制**：確保自回歸預測過程中不會洩漏未來信息

### MPC 控制策略
- **前向預測**：基於 Transformer 模型預測未來溫度變化
- **滾動優化**：在預測時域內優化控制序列
- **目標函數**：結合溫度誤差、能耗和控制平滑度的多目標優化
- **約束處理**：實現軟/硬約束，確保控制動作在安全範圍內

### 優化算法

- **模擬退火 (SA)**：全局優化方法，避免陷入局部最優


## 🔍 監控與調試
### 數據監控
- 即時溫度監控
- 系統狀態記錄
- 異常檢測

### 效能優化
- 模型參數調整
- 控制策略優化
- 系統效能分析

## 📝 注意事項
1. 確保硬體連接正確
2. 定期檢查數據記錄
3. 監控系統溫度變化
4. 注意控制參數範圍

## 🛠 故障排除
1. **連接問題**：檢查 ADAM 模組與 PWM 控制器的串口連接
2. **模型異常**：檢查輸入數據標準化是否與訓練時一致
3. **控制不穩定**：調整 MPC 的預測時域或優化算法參數
4. **溫度波動大**：考慮調整控制參數或使用更強魯棒性的優化算法

## 📈 未來改進方向
1. 加入強化學習控制策略
2. 整合更多環境因素進入預測模型
3. 實現分布式多目標控制
4. 開發自適應模型更新機制


